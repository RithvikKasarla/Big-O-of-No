generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("SQL_DATABASE_URL")
}

model User {
  id       Int     @id @default(autoincrement())
  username String  @unique
  files    File[]  @relation("UserFiles")
  posts    Post[]  @relation("UserPosts")
  classes  Class[] @relation("ClassMembership")
}

model Class {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  description String?
  posts       Post[]  @relation("ClassPosts")
  members     User[]  @relation("ClassMembership")
}

model Post {
  id       Int     @id @default(autoincrement())
  title    String
  content  String?
  authorId Int
  classId  Int
  files    File[]  @relation("PostFiles")
  author   User    @relation("UserPosts", fields: [authorId], references: [id])
  class    Class   @relation("ClassPosts", fields: [classId], references: [id])

  @@index([authorId], map: "Post_authorId_fkey")
  @@index([classId], map: "Post_classId_fkey")
}

model File {
  id       Int    @id @default(autoincrement())
  filename String
  postId   Int?
  s3_url   String @unique
  authorId Int
  author   User   @relation("UserFiles", fields: [authorId], references: [id])
  post     Post?  @relation("PostFiles", fields: [postId], references: [id])

  @@index([authorId], map: "File_authorId_fkey")
  @@index([postId], map: "File_postId_fkey")
}
